{% extends "base_systems.html" %}

{% block content %}

<h2>Marketplace</h2>

<h3>Market Data</h3>
<table>
    <thead>
        <tr>
            <th>Exports</th>
            <th>Imports</th>
            <th>Exchanges</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>
                {% for export in market.exports.all %}
                <li>{{ export }}</li>
                {% endfor %}
            </td>
            <td>
                {% for import in market.imports.all %}
                <li>{{ import }}</li>
                {% endfor %}
            </td>
            <td>
                {% for exchange in market.exchanges.all %}
                <li>{{ exchange }}</li>
                {% endfor %}
            </td>
        </tr>
    </tbody>
</table>

<form method="post">
    {% csrf_token %}
    <input type="hidden" name="update_market" value="true">
    <input type="hidden" name="market_symbol" value="{{ market.pk }}">
    <label for="update_market">Update Market:</label>
    <input type="submit" value="Update">
</form>

<h3>Recent Transactions</h3>
<table>
    <thead>
        <tr>
            <th>Market</th>
            <th>Ship Symbol</th>
            <th>Trade Good</th>
            <th>Transaction Type</th>
            <th>Units</th>
            <th>Price Per Unit</th>
            <th>Total Price</th>
            <th>Timestamp</th>
        </tr>
    </thead>
    <tbody>
        {% for transaction in market.transactions.all %}
        <tr>
            <td>{{ transaction.market }}</td>
            <td>{{ transaction.ship_symbol }}</td>
            <td>{{ transaction.trade_good }}</td>
            <td>{{ transaction.transaction_type }}</td>
            <td>{{ transaction.units }}</td>
            <td>{{ transaction.price_per_unit }}</td>
            <td>{{ transaction.total_price }}</td>
            <td>{{ transaction.timestamp }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

{% if docked_ships %}
<h3>Docked Ships</h3>
{% for ship in docked_ships %}
<li><a href="{% url 'fleet:detail' pk=ship.symbol %}">{{ ship }}</a></li>
{% endfor %}
<form method="post">
    {% csrf_token %}
    <input type="hidden" name="ship_sell_cargo" value="true">
    <label for="ship_symbol">Sell Cargo:</label>
    <select name="ship_symbol" id="ship_symbol">
        {% for ship in docked_ships %}
        <option value="{{ ship.symbol }}">{{ ship.symbol }}</option>
        {% endfor %}
    </select>
    <label for="trade_good">Trade Good:</label>
    <select name="trade_good" id="trade_good">
        {% for inventory in ship_cargo_inventories %}
        <option value="{{ inventory.trade_good.id }}">{{ inventory.trade_good }}</option>
        {% endfor %}
    </select>
    <label for="units">Units:</label>
    <input type="number" id="units" name="units" min="1">
    <input type="submit" value="Sell">
</form>
{% endif %}
{% endblock %}
